---
layout: post
title: '[ML/DL] 이미지 품질 평가 PSNR/ SSIM'
subtitle: 'test'
categories: programing
tags: deeplearning
comments: true
---
 컴퓨터 비전 분야 혹인 딥러닝을 이용한 이미지 복원 분야에서 이미지의 품질을 정량적으로 평가할 수 있는 방법이 필요하다. 본 글에서는 여러 가지 방법 중에 잘 알려진 PSNR(Peak Signal-to-Noise Ratio)와 SSIM(Structual Similarity)에 대해 설명한다. 나는 이 두 가지 평가 척도를 De-Rain(Rain removal) 모델의 성능을 검증하는 평가 척도와 Loss Function에 이용해볼 예정이다.

## 1\. MSE(Mean Squre Error)

![](/assets/img/2020-01-16-15-29-30.png){: width="249" height="49"}*MSE 수학식*

 PSNR에 MSE가 쓰이기 때문에 간단하게 설명한다. MSE는 평균 제곱 오차를 말하며 이미지 복원 분야뿐만 아니라 여러 이미지 관련 문제에서 이미지 간의 차이를 측정하기 위한 수단으로써 쓰이는 방법이다. 원본 이미지와 복원 이미지가 있다면 두 이미지의 픽셀 값들의 차이에 대한 측정값을 나타낸다.

## 2\. PSNR(Peak Signal-to-Noise Ratio)

![](/assets/img/2020-01-16-16-43-43.png){: width="192" height="53"}*PSNR 수학식*

 신호가 가질 수 있는 최대 신호에 대한 잡음의 비를 나타내며 이미지 또는 영상 분야에서 생성 혹은 압축된 영상의 화질에 대한 손실 정보를 평가하기 위한 목적으로 사용한다. $$$ s $$$는 영상에서의 최대 값으로서 해당 채널의 최댓값에서 최솟값을 뺀 값이다. 예를 들면 8-bit Gray 이미지일 경우 255(255-0)가 된다. 단위는 데시벨\[db\]을 사용하며 , 손실이 적을수록 높은 값을 가진다. 무손실 영상의 경우 MSE가 0 이 되기 때문에 PSNR은 정의되지 않는다.

## 3\. SSIM(Structural Similarity Index Map)

 SSIM은 수치적인 에러가 아닌 인간의 시각적 화질 차이 및 유사도를 평가하기 위해 고안된 방법이다. 사람의 시각 시스템은 이미지의 구조 정보를 도출하는데 특화되어 있기 때문에 구조 정보의 왜곡 정도가 지각에 큰 영향을 미친다는 것이 SSIM의 핵심 가설이다. 원본 이미지 $$$ A $$$와 왜곡된 이미지 $$$ B $$$ 가 있다고 할 때 SSIM은 두 이미지의 휘도, 대비, 및 구조를 비교한다.

-   두 이미지간의 평균 휘도 비교:

![](/assets/img/2020-01-16-16-44-18.png){: width="228" height="59"}*휘도를 비교하기 위한 수식*

-   이미지의 표준 편차 값을 이미지의 대비로 정의하고, 두 이미지의 표준편차 값을 비교:

![](/assets/img/2020-01-16-16-44-51.png){: width="231" height="60"}*대비를 비교하기 위한 수식*

-   이미지의 구조는 이미지에서 평균 휘도를 뺀 후, 표준 편차로 나누어 정의:

![](/assets/img/2020-01-16-16-45-10.png{: width="119" height="48"})*이미지의 구조 정의*

-   저자들은 위의 이미지 구조 간의 상관계수를 구하는 것과 $$$ A $$$와 $$$ B $$$의 상관계수를 구하는 것이 등가라고 판단해, 이미지 $$$ A $$$,$$$ B $$$의 상관 계수를 구함으로서 이미지와 왜곡된 이미지 구조를 다음과 같이 비교한다:

![](/assets/img/2020-01-16-16-45-30.png){: width="172" height="54"}*구조 비교를 위한 수식*

-   위에서 구한 3가지 항목을  묶어 품질 맵을 정의 한며 이것이 SSIM을 나타낸다:

![](/assets/img/2020-01-16-16-46-30.png){: width="361" height="83"}*SSIM 수식*

-   추가로 위의 수식들에서 나온 \(C_1,C_2,C_3\)은 아래와 같이 정의된 디폴트 값이다($$$ L $$$은 지정된 Dynamic Range 값):

![](/assets/img/2020-01-16-16-46-57.png){: width="163" height="108"}*정의된 디폴트 값*

저자들은 이 SSIM을 전역 적으로 적용하지 않고 지역적으로 적용했다. 픽셀들의 값의 평균을 구함으로써 최종 품질 점수를 얻었다.

![](/assets/img/2020-01-16-16-47-31.png){: width="729" height="262"}*왼쪽 부터 원본이미지, 블러처리한 이미지,  SSIM을 시각화 한 이미지(출처. MALAB SSIM 함수 도큐먼트)*